Error reporting changed to be better readable, some library changes.

Nearly untested.
